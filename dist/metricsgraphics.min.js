function chart_title(a){"use strict";var b=d3.select(a.target);if(b.select(".mg-chart-title").remove(),a.target&&a.title){var c=a.show_tooltips&&a.description?'<i class="fa fa-question-circle fa-inverse description"></i>':"";if(b.insert("h2",":first-child").attr("class","mg-chart-title").html(a.title+c),a.show_tooltips&&a.description){var d=$(b.node()).find("h2.mg-chart-title");d.popover({html:!0,animation:!1,content:a.description,trigger:"hover",placement:"top",container:d})}}a.error&&error(a)}function y_rug(a){"use strict";for(var b=mg_get_svg_child_of(a.target),c="point"===a.chart_type?a.buffer/2:2*a.buffer/3,d=[],e=0;e<a.data.length;e++)for(var f=0;f<a.data[e].length;f++)d.push(a.data[e][f]);var g=b.selectAll("line.mg-y-rug").data(d);g.enter().append("svg:line").attr("class","mg-y-rug").attr("opacity",.3),g.exit().remove(),g.exit().remove(),g.attr("x1",a.left+1).attr("x2",a.left+c).attr("y1",a.scalefns.yf).attr("y2",a.scalefns.yf),a.color_accessor?(g.attr("stroke",a.scalefns.color),g.classed("mg-y-rug-mono",!1)):(g.attr("stroke",null),g.classed("mg-y-rug-mono",!0))}function y_axis(a){function b(a){return 1e3===a?3:1e6===a?7:Math.log(a)/Math.LN10}a.processed||(a.processed={});var c,d,e,f=mg_get_svg_child_of(a.target);a.scalefns.yf=function(b){return a.missing_is_hidden&&b.missing?a.scales.Y(b[a.y_accessor])+42.1234:a.scales.Y(b[a.y_accessor])};for(var g=!1,h=function(b){return b[a.y_accessor]>0},i=function(b){return b[a.y_accessor]},j=0;j<a.data.length;j++){var k=a.data[j];if("log"===a.y_scale_type&&(k=k.filter(h)),k.length>0){var l=d3.extent(k,i);g?(d=Math.min(l[0],d),e=Math.max(l[1],e)):(d=l[0],e=l[1],g=!0)}}d>=0&&!a.min_y&&!a.min_y_from_data&&(d=0),"bar"===a.chart_type&&(d=0,e=d3.max(a.data[0],function(b){var c=[];return c.push(b[a.y_accessor]),null!==a.baseline_accessor&&c.push(b[a.baseline_accessor]),null!==a.predictor_accessor&&c.push(b[a.predictor_accessor]),Math.max.apply(null,c)})),d=null!==a.min_y?a.min_y:d,e=null!==a.max_y?a.max_y:e*a.inflator,"log"!==a.y_scale_type&&(d>=0?a.y_axis_negative=!1:(d-=e*(a.inflator-1),a.y_axis_negative=!0)),!a.min_y&&a.min_y_from_data&&(d/=a.inflator),"log"===a.y_scale_type?("histogram"===a.chart_type?d=.2:0>=d&&(d=1),a.scales.Y=d3.scale.log().domain([d,e]).range([a.height-a.bottom-a.buffer,a.top]).clamp(!0)):a.scales.Y=d3.scale.linear().domain([d,e]).range([a.height-a.bottom-a.buffer,a.top]),a.processed.min_y=d,a.processed.max_y=e,a.scales.Y_axis=d3.scale.linear().domain([a.processed.min_y,a.processed.max_y]).range([a.height-a.bottom-a.buffer,a.top]);var m=a.yax_format;if(m||(m="count"===a.format?function(b){if(1>b)return a.yax_units+d3.round(b,a.decimals);var c=d3.formatPrefix(b);return a.yax_units+c.scale(b)+c.symbol}:function(a){var b=d3.format("%p");return b(a)}),f.selectAll(".mg-y-axis").remove(),!a.y_axis)return this;c=f.append("g").classed("mg-y-axis",!0).classed("mg-y-axis-small",a.use_small_class),a.y_label&&c.append("text").attr("class","label").attr("x",function(){return-1*(a.top+a.buffer+(a.height-a.bottom-a.buffer-(a.top+a.buffer))/2)}).attr("y",function(){return a.left/2}).attr("dy","0.4em").attr("text-anchor","middle").text(function(){return a.y_label}).attr("transform",function(){return"rotate(-90)"});var n=a.scales.Y.ticks(a.yax_count);"log"===a.y_scale_type&&(n=n.filter(function(a){return Math.abs(b(a))%1<1e-6||Math.abs(b(a))%1>1-1e-6}));var o=a.scales.Y.ticks(a.yax_count).length,p=!0;a.data.forEach(function(b){b.forEach(function(b){return b[a.y_accessor]%1!==0?(p=!1,!1):void 0})}),p&&o>e&&"count"===a.format&&(n=n.filter(function(a){return a%1===0}));var q=n.length-1;return a.x_extended_ticks||a.y_extended_ticks||c.append("line").attr("x1",a.left).attr("x2",a.left).attr("y1",a.scales.Y(n[0]).toFixed(2)).attr("y2",a.scales.Y(n[q]).toFixed(2)),c.selectAll(".mg-yax-ticks").data(n).enter().append("line").classed("mg-extended-y-ticks",a.y_extended_ticks).attr("x1",a.left).attr("x2",function(){return a.y_extended_ticks?a.width-a.right:a.left-a.yax_tick_length}).attr("y1",function(b){return a.scales.Y(b).toFixed(2)}).attr("y2",function(b){return a.scales.Y(b).toFixed(2)}),c.selectAll(".mg-yax-labels").data(n).enter().append("text").attr("x",a.left-3*a.yax_tick_length/2).attr("dx",-3).attr("y",function(b){return a.scales.Y(b).toFixed(2)}).attr("dy",".35em").attr("text-anchor","end").text(function(a){var b=m(a);return b}),a.y_rug&&y_rug(a),this}function y_axis_categorical(a){a.scales.Y=d3.scale.ordinal().domain(a.categorical_variables).rangeRoundBands([a.height-a.bottom-a.buffer,a.top],a.padding_percentage,a.outer_padding_percentage),a.scalefns.yf=function(b){return a.scales.Y(b[a.y_accessor])};var b=mg_get_svg_child_of(a.target);b.selectAll(".mg-y-axis").remove();var c=b.append("g").classed("mg-y-axis",!0).classed("mg-y-axis-small",a.use_small_class);return a.y_axis?(c.selectAll("text").data(a.categorical_variables).enter().append("svg:text").attr("x",a.left).attr("y",function(b){return a.scales.Y(b)+a.scales.Y.rangeBand()/2+a.buffer*a.outer_padding_percentage}).attr("dy",".35em").attr("text-anchor","end").text(String),this):this}function x_rug(a){"use strict";for(var b="point"===a.chart_type?a.buffer/2:a.buffer,c=mg_get_svg_child_of(a.target),d=[],e=0;e<a.data.length;e++)for(var f=0;f<a.data[e].length;f++)d.push(a.data[e][f]);var g=c.selectAll("line.mg-x-rug").data(d);g.enter().append("svg:line").attr("class","mg-x-rug").attr("opacity",.3),g.exit().remove(),g.exit().remove(),g.attr("x1",a.scalefns.xf).attr("x2",a.scalefns.xf).attr("y1",a.height-a.top+b).attr("y2",a.height-a.top),a.color_accessor?(g.attr("stroke",a.scalefns.color),g.classed("mg-x-rug-mono",!1)):(g.attr("stroke",null),g.classed("mg-x-rug-mono",!0))}function x_axis(a){"use strict";var b,c=mg_get_svg_child_of(a.target);if(a.processed={},a.scalefns.xf=function(b){return a.scales.X(b[a.x_accessor])},"point"===a.chart_type&&(mg_point_add_color_scale(a),mg_point_add_size_scale(a)),mg_find_min_max_x(a),a.scales.X=a.time_series?d3.time.scale():d3.scale.linear(),a.scales.X.domain([a.processed.min_x,a.processed.max_x]).range([a.left+a.buffer,a.width-a.right-a.buffer-a.additional_buffer]),c.selectAll(".mg-x-axis").remove(),!a.x_axis)return this;b=c.append("g").classed("mg-x-axis",!0).classed("mg-x-axis-small",a.use_small_class);a.scales.X.ticks(a.xax_count).length-1;return a.x_label&&mg_add_x_label(b,a),mg_add_x_ticks(b,a),mg_add_x_tick_labels(b,a),a.x_rug&&x_rug(a),this}function x_axis_categorical(a){var b=mg_get_svg_child_of(a.target),c=(a.width,0);"bar"===a.chart_type&&(c=a.buffer+5),a.scales.X=d3.scale.ordinal().domain(a.categorical_variables.reverse()).rangeRoundBands([a.left,a.width-a.right-a.buffer-c]),a.scalefns.xf=function(b){return a.scales.X(b[a.x_accessor])},b.selectAll(".mg-x-axis").remove();var d=b.append("g").classed("mg-x-axis",!0).classed("mg-x-axis-small",a.use_small_class);if(!a.x_axis)return this;var e=d.selectAll("text").data(a.categorical_variables).enter().append("svg:text");return e.attr("x",function(b){return a.scales.X(b)+a.scales.X.rangeBand()/2+a.buffer*a.outer_padding_percentage+c/2}).attr("y",a.height-a.bottom+a.buffer).attr("dy",".35em").attr("text-anchor","middle").text(String),e.each(function(b){var c=this,d=a.scales.X.rangeBand();truncate_text(c,b,d)}),this}function mg_point_add_color_scale(a){var b,c,d,e;null!==a.color_accessor&&(null===a.color_domain?"number"===a.color_type?(b=d3.min(a.data[0],function(b){return b[a.color_accessor]}),c=d3.max(a.data[0],function(b){return b[a.color_accessor]}),d=[b,c]):"category"===a.color_type&&(d=d3.set(a.data[0].map(function(b){return b[a.color_accessor]})).values(),d.sort()):d=a.color_domain,e=null===a.color_range?"number"===a.color_type?["blue","red"]:null:a.color_range,"number"===a.color_type?a.scales.color=d3.scale.linear().domain(d).range(e).clamp(!0):(a.scales.color=null!==a.color_range?d3.scale.ordinal().range(e):d.length>10?d3.scale.category20():d3.scale.category10(),a.scales.color.domain(d)),a.scalefns.color=function(b){return a.scales.color(b[a.color_accessor])})}function mg_point_add_size_scale(a){var b,c,d,e;null!==a.size_accessor&&(null===a.size_domain?(b=d3.min(a.data[0],function(b){return b[a.size_accessor]}),c=d3.max(a.data[0],function(b){return b[a.size_accessor]}),d=[b,c]):d=a.size_domain,e=null===a.size_range?[1,5]:a.size_range,a.scales.size=d3.scale.linear().domain(d).range(e).clamp(!0),a.scalefns.size=function(b){return a.scales.size(b[a.size_accessor])})}function mg_add_x_label(a,b){a.append("text").attr("class","label").attr("x",function(){return b.left+b.buffer+(b.width-b.right-b.buffer-(b.left+b.buffer))/2}).attr("y",(b.height-b.bottom/2).toFixed(2)).attr("dy",".50em").attr("text-anchor","middle").text(function(){return b.x_label})}function mg_default_bar_xax_format(a){return a.xax_format?a.xax_format:function(b){if(1>b)return a.xax_units+d3.round(b,a.decimals);var c=d3.formatPrefix(b);return a.xax_units+c.scale(b)+c.symbol}}function mg_default_xax_format(a){if(a.xax_format)return a.xax_format;var b,c,d;return a.time_series&&(b=(a.processed.max_x-a.processed.min_x)/1e3,60>b?(c=d3.time.format("%M:%S"),d="seconds"):24>=b/3600?(c=d3.time.format("%H:%M"),d="less-than-a-day"):96>=b/3600?(c=d3.time.format("%H:%M"),d="four-days"):(c=d3.time.format("%b %d"),d="default")),a.processed.main_x_time_format=c,a.processed.x_time_frame=d,function(b){var c=(d3.time.format("%b %d"),d3.formatPrefix(b));return a.data[0][0][a.x_accessor]instanceof Date?a.processed.main_x_time_format(b):"number"==typeof a.data[0][0][a.x_accessor]?1>b?a.xax_units+d3.round(b,a.decimals):(c=d3.formatPrefix(b),a.xax_units+c.scale(b)+c.symbol):b}}function mg_add_x_ticks(a,b){var c=b.scales.X.ticks(b.xax_count).length-1;"bar"===b.chart_type||b.x_extended_ticks||b.y_extended_ticks||a.append("line").attr("x1",b.concise===!1||0===b.xax_count?b.left+b.buffer:b.scales.X(b.scales.X.ticks(b.xax_count)[0]).toFixed(2)).attr("x2",b.concise===!1||0===b.xax_count?b.width-b.right-b.buffer:b.scales.X(b.scales.X.ticks(b.xax_count)[c]).toFixed(2)).attr("y1",b.height-b.bottom).attr("y2",b.height-b.bottom),a.selectAll(".mg-xax-ticks").data(b.scales.X.ticks(b.xax_count)).enter().append("line").attr("x1",function(a){return b.scales.X(a).toFixed(2)}).attr("x2",function(a){return b.scales.X(a).toFixed(2)}).attr("y1",b.height-b.bottom).attr("y2",function(){return b.x_extended_ticks?b.top:b.height-b.bottom+b.xax_tick_length}).attr("class",function(){return b.x_extended_ticks?"mg-extended-x-ticks":void 0})}function mg_add_x_tick_labels(a,b){if(a.selectAll(".mg-xax-labels").data(b.scales.X.ticks(b.xax_count)).enter().append("text").attr("x",function(a){return b.scales.X(a).toFixed(2)}).attr("y",(b.height-b.bottom+7*b.xax_tick_length/3).toFixed(2)).attr("dy",".50em").attr("text-anchor","middle").text(function(a){return b.xax_units+b.xax_format(a)}),b.time_series&&(b.show_years||b.show_secondary_x_label)){var c,d,e=b.processed.x_time_frame;switch(e){case"seconds":c=d3.time.days,d=d3.time.format("%I %p");break;case"less-than-a-day":c=d3.time.days,d=d3.time.format("%b %d");break;case"four-days":c=d3.time.days,d=d3.time.format("%b %d");break;default:c=d3.time.years,d=d3.time.format("%Y")}var f=c(b.processed.min_x,b.processed.max_x);if(0===f.length){var g=b.scales.X.ticks(b.xax_count)[0];f=[g]}a=a.append("g").classed("mg-year-marker",!0).classed("mg-year-marker-small",b.use_small_class),"default"===e&&a.selectAll(".mg-year-marker").data(f).enter().append("line").attr("x1",function(a){return b.scales.X(a).toFixed(2)}).attr("x2",function(a){return b.scales.X(a).toFixed(2)}).attr("y1",b.top).attr("y2",b.height-b.bottom),a.selectAll(".mg-year-marker").data(f).enter().append("text").attr("x",function(a){return b.scales.X(a).toFixed(2)}).attr("y",(b.height-b.bottom+7*b.xax_tick_length/1.3).toFixed(2)).attr("dy",b.use_small_class?-3:0).attr("text-anchor","middle").text(function(a){return d(a)})}}function mg_find_min_max_x(a){var b,c,d=[],e=[].concat.apply([],a.data),f=function(b){return b[a.x_accessor]};if(delete a.xax_format,"line"===a.chart_type||"point"===a.chart_type||"histogram"===a.chart_type?(d=d3.extent(e,f),b=d[0],c=d[1]):"bar"===a.chart_type&&(b=0,c=d3.max(e,function(b){var c=[b[a.x_accessor],b[a.baseline_accessor]?b[a.baseline_accessor]:0,b[a.predictor_accessor]?b[a.predictor_accessor]:0];return Math.max.apply(null,c)})),b===c){if(b instanceof Date){var g=MG.clone(b).setDate(b.getDate()-1),h=MG.clone(b).setDate(b.getDate()+1);b=g,c=h}else"number"==typeof b?(b-=1,c+=1):"string"==typeof b&&(b=Number(b)-1,c=Number(c)+1);a.xax_count=2}b=a.min_x?a.min_x:b,c=a.max_x?a.max_x:c,a.x_axis_negative=!1,a.processed.min_x=b,a.processed.max_x=c,mg_select_xax_format(a),a.time_series||a.processed.min_x<0&&(a.processed.min_x=a.processed.min_x-a.processed.max_x*(a.inflator-1),a.x_axis_negative=!0),a.additional_buffer="bar"===a.chart_type?5*a.buffer:0}function mg_select_xax_format(a){a.xax_format||"line"!==a.chart_type||(a.xax_format=mg_default_xax_format(a)),a.xax_format||"point"!==a.chart_type||(a.xax_format=mg_default_xax_format(a)),a.xax_format||"histogram"!==a.chart_type||(a.xax_format=mg_default_xax_format(a)),a.xax_format||"bar"!==a.chart_type||(a.xax_format=mg_default_bar_xax_format(a))}function init(a){"use strict";var b={target:null,title:null,description:null};if(a=arguments[0],a||(a={}),a=merge_with_defaults(a,b),d3.select(a.target).empty())return void console.warn('The specified target element "'+a.target+'" could not be found in the page. The chart will not be rendered.');var c=d3.select(a.target),d=c.selectAll("svg");a.time_series=a.data[0][0][a.x_accessor]instanceof Date?!0:!1;var e=a.width,f=a.height;a.full_width&&(e=get_width(a.target)),a.fill_height&&(f=get_height(a.target)),"bar"===a.chart_type&&null===f&&(f=a.height=a.data[0].length*a.bar_height+a.top+a.bottom),(!d.selectAll(".mg-main-line").empty()&&"line"!==a.chart_type||!d.selectAll(".mg-points").empty()&&"point"!==a.chart_type||!d.selectAll(".mg-histogram").empty()&&"histogram"!==a.chart_type||!d.selectAll(".mg-barplot").empty()&&"bar"!==a.chart_type)&&d.remove(),mg_get_svg_child_of(a.target).empty()&&(d=d3.select(a.target).append("svg").classed("linked",a.linked).attr("width",e).attr("height",f)),a.width=e,a.height=f,d.selectAll(".mg-clip-path").remove(),d.append("defs").attr("class","mg-clip-path").append("clipPath").attr("id","mg-plot-window-"+mg_strip_punctuation(a.target)).append("svg:rect").attr("x",a.left).attr("y",a.top).attr("width",a.width-a.left-a.right-a.buffer).attr("height",a.height-a.top-a.bottom-a.buffer+1),e!==Number(d.attr("width"))&&d.attr("width",e),f!==Number(d.attr("height"))&&d.attr("height",f),d.attr("viewBox","0 0 "+e+" "+f),(a.full_width||a.full_height)&&d.attr("preserveAspectRatio","xMinYMin meet"),d.classed("mg-missing",!1),d.selectAll(".mg-missing-text").remove(),d.selectAll(".mg-missing-pane").remove(),chart_title(a),a.use_small_class=a.height-a.top-a.bottom-a.buffer<=a.small_height_threshold&&a.width-a.left-a.right-2*a.buffer<=a.small_width_threshold||a.small_text;var g=0;if(a.data.length<d.selectAll(".mg-main-line")[0].length)if(a.custom_line_color_map.length>0){var h=function(a){for(var b=new Array(a),c=0;c<b.length;c++)b[c]=c+1;return b},i=arrDiff(h(a.max_data_size),a.custom_line_color_map);for(g=0;g<i.length;g++)d.selectAll(".mg-main-line.mg-line"+i[g]+"-color").remove()}else{var j=a.data.length,k=d.selectAll(".mg-main-line")[0].length;for(g=k;g>j;g--)d.selectAll(".mg-main-line.mg-line"+g+"-color").remove()}return this}function markers(a){"use strict";function b(b){var d;b.each(function(e,f){if(f>0){{this.getBoundingClientRect()}if(c(this,b)){var g=d3.select(this),h=+g.attr("y");h+8==a.top&&(h=a.top-16),g.attr("y",h)}}d=this})}function c(a,b){for(var c=a.getBoundingClientRect(),d=0;d<b.length;d++){var e=b[0][d].getBoundingClientRect();if(b[0][d]!==a&&(e.right>c.left&&e.left>c.left&&c.top===e.top||e.left<c.left&&e.right>c.left&&c.top===e.top))return!0}return!1}function d(b){return a.scales.X(b[a.x_accessor])}function e(a){return d(a).toFixed(2)}function f(b){return a.scales.X(b[a.x_accessor])>a.buffer+a.left&&a.scales.X(b[a.x_accessor])<a.width-a.buffer-a.right}var g,h,i=mg_get_svg_child_of(a.target);return i.selectAll(".mg-markers").remove(),i.selectAll(".mg-baselines").remove(),a.markers&&(g=i.append("g").attr("class","mg-markers"),g.selectAll(".mg-markers").data(a.markers.filter(f)).enter().append("line").attr("x1",e).attr("x2",e).attr("y1",a.top).attr("y2",function(){return a.height-a.bottom-a.buffer}).attr("stroke-dasharray","3,1"),g.selectAll(".mg-markers").data(a.markers.filter(f)).enter().append("text").attr("class","mg-marker-text").attr("x",d).attr("y",a.top-8).attr("text-anchor","middle").text(function(a){return a.label}),b(g.selectAll(".mg-marker-text"))),a.baselines&&(h=i.append("g").attr("class","mg-baselines"),h.selectAll(".mg-baselines").data(a.baselines).enter().append("line").attr("x1",a.left+a.buffer).attr("x2",a.width-a.right-a.buffer).attr("y1",function(b){return a.scales.Y(b.value).toFixed(2)}).attr("y2",function(b){return a.scales.Y(b.value).toFixed(2)}),h.selectAll(".mg-baselines").data(a.baselines).enter().append("text").attr("x",a.width-a.right-a.buffer).attr("y",function(b){return a.scales.Y(b.value).toFixed(2)}).attr("dy",-3).attr("text-anchor","end").text(function(a){return a.label})),this}function mg_window_listeners(a){mg_if_aspect_ratio_resize_svg(a)}function mg_if_aspect_ratio_resize_svg(a){(a.full_width||a.full_height)&&window.addEventListener("resize",function(){var b=d3.select(a.target).select("svg"),c=b.attr("height")/b.attr("width"),d=get_width(a.target);b.attr("width",d),b.attr("height",c*d)},!0)}function raw_data_transformation(a){"use strict";if("line"===a.chart_type){var b=a.data[0]instanceof Object&&!(a.data[0]instanceof Array),c=a.data[0]instanceof Array&&!(a.data[0][0]instanceof Object&&!(a.data[0][0]instanceof Date));(b||c)&&(a.data=[a.data])}else a.data[0]instanceof Array||(a.data=[a.data]);if(a.y_accessor instanceof Array&&(a.data=a.data.map(function(b){return a.y_accessor.map(function(a){return b.map(function(b){return b=MG.clone(b),void 0===b[a]?void 0:(b.multiline_y_accessor=b[a],b)}).filter(function(a){return void 0!==a})})})[0],a.y_accessor="multiline_y_accessor"),"line"===a.chart_type)for(var d=0;d<a.data.length;d++)a.data[d].sort(function(b,c){return b[a.x_accessor]-c[a.x_accessor]});return this}function process_line(a){"use strict";var b=a.data[0][0][a.x_accessor]instanceof Date?!0:!1;if(a.missing_is_hidden&&(a.interpolate="linear"),(a.missing_is_zero||a.missing_is_hidden)&&"line"===a.chart_type&&b)for(var c=0;c<a.data.length;c++)if(1!=a.data[c].length){for(var d=a.data[c][0],e=a.data[c][a.data[c].length-1],f=[],g=MG.clone(d[a.x_accessor]).setDate(d[a.x_accessor].getDate()+1),h=a.min_x?a.min_x:g,i=a.max_x?a.max_x:e[a.x_accessor],j=new Date(h);i>=j;j.setDate(j.getDate()+1)){var k={};j.setHours(0,0,0,0),Date.parse(j)===Date.parse(new Date(g))&&f.push(MG.clone(a.data[c][0]));var l=null;a.data[c].forEach(function(b){return Date.parse(b[a.x_accessor])===Date.parse(new Date(j))?(l=b,!1):void 0}),l?f.push(l):(k[a.x_accessor]=new Date(j),k[a.y_accessor]=0,k.missing=!0,f.push(k)),Date.parse(j)===Date.parse(new Date(e[a.x_accessor]))&&f.push(e)}a.data[c]=f}return this}function process_histogram(a){"use strict";var b,c=a.data[0];if(a.binned===!1){if("object"==typeof c[0])b=c.map(function(b){return b[a.x_accessor]});else{if("number"!=typeof c[0])return void console.log("TypeError: expected an array of numbers, found "+typeof c[0]);b=c}var d=d3.layout.histogram();a.bins&&(d=d.bins(a.bins)),a.processed_data=d(b).map(function(a){return{x:a.x,y:a.y,dx:a.dx}})}else{a.processed_data=c.map(function(b){return{x:b[a.x_accessor],y:b[a.y_accessor]}});for(var e,f,g=0;g<a.processed_data.length;g++)e=a.processed_data[g],g===a.processed_data.length-1?e.dx=a.processed_data[g-1].dx:(f=a.processed_data[g+1],e.dx=f.x-e.x)}return a.data=[a.processed_data],a.x_accessor=a.processed_x_accessor,a.y_accessor=a.processed_y_accessor,this}function process_categorical_variables(a){"use strict";var b,c={},d=a.data[0],e="vertical"===a.bar_orientation?a.x_accessor:a.y_accessor,f="vertical"===a.bar_orientation?a.y_accessor:a.x_accessor;if(a.categorical_variables=[],a.binned===!1){b="object"==typeof d[0]?d.map(function(a){return a[e]}):d;for(var g,h=0;h<b.length;h++)g=b[h],-1===a.categorical_variables.indexOf(g)&&a.categorical_variables.push(g),c.hasOwnProperty(g)||(c[g]=0),c[g]+=1;c=Object.keys(c).map(function(a){var b={};return b[f]=c[a],b[e]=a,b})}else c=d,a.categorical_variables=d3.set(c.map(function(a){return a[e]})).values(),a.categorical_variables.reverse();return a.data=[c],this}function process_point(a){"use strict";var b=a.data[0],c=b.map(function(b){return b[a.x_accessor]}),d=b.map(function(b){return b[a.y_accessor]});return a.least_squares&&(a.ls_line=least_squares(c,d)),this}function add_ls(a){var b=mg_get_svg_child_of(a.target),c=(a.data[0],a.scales.X.ticks(a.xax_count)[0]),d=a.scales.X.ticks(a.xax_count)[a.scales.X.ticks(a.xax_count).length-1];d3.select(a.target).selectAll(".mg-least-squares-line").remove(),b.append("svg:line").attr("x1",a.scales.X(c)).attr("x2",a.scales.X(d)).attr("y1",a.scales.Y(a.ls_line.fit(c))).attr("y2",a.scales.Y(a.ls_line.fit(d))).attr("class","mg-least-squares-line")}function add_lowess(a){var b=d3.select($(a.target).find("svg").get(0)),c=a.lowess_line,d=d3.svg.line().x(function(b){return a.scales.X(b.x)}).y(function(b){return a.scales.Y(b.y)}).interpolate(a.interpolate);b.append("path").attr("d",d(c)).attr("class","mg-lowess-line")}function lowess_robust(a,b,c,d){{var e,f,g=[];d3.mean(b)}for(f=0;f<a.length;f+=1)g.push(1);e=_calculate_lowess_fit(a,b,c,d,g);var h=e.x,i=e.y;for(f=0;100>f;f+=1){g=d3.zip(i,b).map(function(a){return Math.abs(a[1]-a[0])});var j=d3.quantile(g.sort(),.5);g=g.map(function(a){return _bisquare_weight(a/(6*j))}),e=_calculate_lowess_fit(a,b,c,d,g),h=e.x,i=e.y}return d3.zip(h,i).map(function(a){var b={};return b.x=a[0],b.y=a[1],b})}function lowess(a,b,c,d){for(var e=[],f=0;f<a.length;f+=1)e.push(1);_calculate_lowess_fit(a,b,c,d,e)}function least_squares(a,b){{var c,d,e,f;a.length}c=a[0]instanceof Date?a.map(function(a){return a.getTime()}):a,d=b[0]instanceof Date?b.map(function(a){return a.getTime()}):b;for(var g=d3.mean(c),h=d3.mean(d),i=0,j=0,k=0;k<c.length;k++)e=c[k],f=d[k],i+=(e-g)*(f-h),j+=(e-g)*(e-g);var l=i/j,m=h-l*g;return{x0:m,beta:l,fit:function(a){return m+a*l}}}function _pow_weight(a,b){return a>=0&&1>=a?Math.pow(1-Math.pow(a,b),b):0}function _bisquare_weight(a){return _pow_weight(a,2)}function _tricube_weight(a){return _pow_weight(a,3)}function _neighborhood_width(a,b){return Array.max(b.map(function(b){return Math.abs(a-b)}))}function _manhattan(a,b){return Math.abs(a-b)}function _weighted_means(a){var b=d3.sum(a.map(function(a){return a.w}));return{xbar:d3.sum(a.map(function(a){return a.w*a.x}))/b,ybar:d3.sum(a.map(function(a){return a.w*a.y}))/b}}function _weighted_beta(a,b,c){var d=d3.sum(a.map(function(a){return Math.pow(a.w,2)*(a.x-b)*(a.y-c)})),e=d3.sum(a.map(function(a){return Math.pow(a.w,2)*(Math.pow(a.x-b),2)}));return d/e}function _weighted_least_squares(a){var b,c,d=_weighted_means(a);c=d.xbar,b=d.ybar;var e=_weighted_beta(a,c,b);return{beta:e,xbar:c,ybar:b,x0:b-e*c}}function _calculate_lowess_fit(a,b,c,d,e){var f=Math.floor(a.length*c),g=a.slice();g.sort(function(a,b){return b>a?-1:a>b?1:0});for(var h,i,j,k,l,m=d3.quantile(g,.98),n=d3.quantile(g,.02),o=d3.zip(a,b,e).sort(),p=Math.abs(m-n)/d,q=n,r=m,s=d3.range(q,r,p),t=[],u=0;u<s.length;u+=1){i=s[u],h=o.map(function(a){return[Math.abs(a[0]-i),a[0],a[1],a[2]]}).sort().slice(0,f),l=d3.max(h)[0],h=h.map(function(a){return{w:_tricube_weight(a[0]/l)*a[3],x:a[1],y:a[2]}});var v=_weighted_least_squares(h);k=v.x0,j=v.beta,t.push(k+j*i)}return{x:s,y:t}}function rolloverNumberFormatter(a){var b;return b="count"===a.format?function(b){var c=b%1!==0,d=d3.format("0,000");return b=c?d3.round(b,a.decimals):b,d(b)}:function(b){var c=(a.decimals?"."+a.decimals:"")+"%",d=d3.format(c);return d(b)}}function pathTween(a,b){return function(){for(var c=this,d=c.cloneNode(),e=c.getTotalLength(),f=(d.setAttribute("d",a),d).getTotalLength(),g=[0],h=0,i=b/Math.max(e,f);(h+=i)<1;)g.push(h);g.push(1);var j=g.map(function(a){var b=c.getPointAtLength(a*e),g=d.getPointAtLength(a*f);return d3.interpolate([b.x,b.y],[g.x,g.y])});return function(b){return 1>b?"M"+j.map(function(a){return a(b)}).join("L"):a}}}function mg_get_svg_child_of(a){return d3.select(a).select("svg")}function mg_strip_punctuation(a){var b=a.replace(/[^a-zA-Z0-9 _]+/g,""),c=b.replace(/ +?/g,"");return c}function get_pixel_dimension(a,b){return Number(d3.select(a).style(b).replace(/px/g,""))}function get_width(a){return get_pixel_dimension(a,"width")}function get_height(a){return get_pixel_dimension(a,"height")}function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}function merge_with_defaults(a){return each(Array.prototype.slice.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a}function number_of_values(a,b,c){var d=a.filter(function(a){return a[b]===c});return d.length}function has_values_below(a,b,c){var d=a.filter(function(a){return a[b]<=c});return d.length>0}function has_too_many_zeros(a,b,c){return number_of_values(a,b,0)>=c}function arrDiff(a,b){var c,d=[],e=[];for(c=0;c<b.length;c++)d[b[c]]=!0;for(c=0;c<a.length;c++)d[a[c]]||e.push(a[c]);return e}function warnDeprecation(a,b){console.warn("Deprecation: "+a+(b?". This feature will be removed in "+b+".":" the near future.")),console.trace()}function truncate_text(a,b,c){var d,e=0;for(a.textContent=b,d=a.getBBox();d.width>c&&(a.textContent=b.slice(0,--e)+"...",d=a.getBBox(),"..."!==a.textContent););}function wrapText(a,b,c,d){a.each(function(){for(var a,e=d3.select(this),f=e.text().split(c||/\s+/).reverse(),g=[],h=0,i=1.1,j=(e.attr("y"),0),k=e.text(null).append("tspan").attr("x",0).attr("y",j+"em").attr(d||{});a=f.pop();)g.push(a),k.text(g.join(" ")),(null===b||k.node().getComputedTextLength()>b)&&(g.pop(),k.text(g.join(" ")),g=[a],k=e.append("tspan").attr("x",0).attr("y",++h*i+j+"em").attr(d||{}).text(a))})}window.MG={version:"2.2.0"};var charts={};MG.globals={},MG.deprecations={rollover_callback:{replacement:"mouseover",version:"2.0"},rollout_callback:{replacement:"mouseout",version:"2.0"},show_years:{replacement:"show_secondary_x_label",version:"2.1"}},MG.globals.link=!1,MG.globals.version="1.1",MG.data_graphic=function(){"use strict";var a={};a.all={missing_is_zero:!1,missing_is_hidden:!1,legend:"",legend_target:"",error:"",animate_on_load:!1,top:40,bottom:30,right:10,left:50,buffer:8,width:350,height:220,full_width:!1,full_height:!1,small_height_threshold:120,small_width_threshold:160,small_text:!1,xax_count:6,xax_tick_length:5,yax_count:5,yax_tick_length:5,x_extended_ticks:!1,y_extended_ticks:!1,y_scale_type:"linear",max_x:null,max_y:null,min_x:null,min_y:null,min_y_from_data:!1,point_size:2.5,x_accessor:"date",xax_units:"",x_label:"",x_axis:!0,y_axis:!0,y_accessor:"value",y_label:"",yax_units:"",x_rug:!1,y_rug:!1,transition_on_update:!0,mouseover:null,show_rollover_text:!0,show_confidence_band:null,xax_format:null,area:!0,chart_type:"line",data:[],decimals:2,format:"count",inflator:10/9,linked:!1,linked_format:"%Y-%m-%d",list:!1,baselines:null,markers:null,scalefns:{},scales:{},show_secondary_x_label:!0,target:"#viz",interpolate:"cardinal",custom_line_color_map:[],max_data_size:null,aggregate_rollover:!1,show_tooltips:!0},a.point={buffer:16,ls:!1,lowess:!1,point_size:2.5,size_accessor:null,color_accessor:null,size_range:null,color_range:null,size_domain:null,color_domain:null,color_type:"number"},a.histogram={mouseover:function(a){d3.select("#histogram svg .mg-active-datapoint").text("Frequency Count: "+a.y)},binned:!1,bins:null,processed_x_accessor:"x",processed_y_accessor:"y",processed_dx_accessor:"dx",bar_margin:1},a.bar={y_accessor:"factor",x_accessor:"value",baseline_accessor:null,predictor_accessor:null,predictor_proportion:5,dodge_accessor:null,binned:!0,padding_percentage:0,outer_padding_percentage:.1,height:500,top:20,bar_height:20,left:70},a.missing={top:40,bottom:30,right:10,left:10,buffer:8,legend_target:"",width:350,height:220,missing_text:"Data currently missing or unavailable",scalefns:{},scales:{},show_missing_background:!0,interpolate:"cardinal"};var b=arguments[0];b||(b={}),b.list&&(b.x_accessor=0,b.y_accessor=1);for(var c in MG.deprecations)if(b.hasOwnProperty(c)){var d=MG.deprecations[c],e="Use of `args."+c+"` has been deprecated",f=d.replacement;if(f&&(b[f]?e+=". The replacement - `args."+f+"` - has already been defined. This definition will be discarded.":b[f]=b[c]),d.warned)continue;d.warned=!0,f&&(e+=" in favor of `args."+f+"`"),warnDeprecation(e,d.version)}var g;return"missing-data"===b.chart_type?(b=merge_with_defaults(b,a.missing),charts.missing(b)):"point"===b.chart_type?(g=merge_with_defaults(a.point,a.all),b=merge_with_defaults(b,g),charts.point(b).mainPlot().markers().rollover().windowListeners()):"histogram"===b.chart_type?(g=merge_with_defaults(a.histogram,a.all),b=merge_with_defaults(b,g),charts.histogram(b).mainPlot().markers().rollover().windowListeners()):"bar"===b.chart_type?(g=merge_with_defaults(a.bar,a.all),b=merge_with_defaults(b,g),charts.bar(b).mainPlot().markers().rollover().windowListeners()):(b=merge_with_defaults(b,a.all),charts.line(b).markers().mainPlot().rollover().windowListeners()),b.data},"undefined"!=typeof jQuery&&(+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b,g=f&&f.selector;(e||"destroy"!=b)&&(g?(e||d.data("bs.tooltip",e={}),e[g]||(e[g]=new c(this,f))):e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}if("function"==typeof a().tooltip)return!0;var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.3.1",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c&&c.$tip&&c.$tip.is(":visible")?void(c.hoverState="in"):(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()
},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.options.container?a(this.options.container):this.$element.parent(),p=this.getPosition(o);h="bottom"==h&&k.bottom+m>p.bottom?"top":"top"==h&&k.top-m<p.top?"bottom":"right"==h&&k.right+l>p.width?"left":"left"==h&&k.left-l<p.left?"right":h,f.removeClass(n).addClass(h)}var q=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(q,h);var r=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",r).emulateTransitionEnd(c.TRANSITION_DURATION):r()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=this.tip(),g=a.Event("hide.bs."+this.type);return this.$element.trigger(g),g.isDefaultPrevented()?void 0:(f.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this)},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type)})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b,g=f&&f.selector;(e||"destroy"!=b)&&(g?(e||d.data("bs.popover",e={}),e[g]||(e[g]=new c(this,f))):e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}if("function"==typeof a().popover)return!0;var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.1",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},c.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery)),"undefined"!=typeof jQuery&&+function(a){"use strict";function b(b){b&&3===b.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=c(d),f={relatedTarget:this};e.hasClass("open")&&(e.trigger(b=a.Event("hide.bs.dropdown",f)),b.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger("hidden.bs.dropdown",f)))}))}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}if("function"==typeof a().dropdown)return!0;var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.1",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger("shown.bs.dropdown",h)}return!1}},g.prototype.keydown=function(b){if(/(38|40|27|32)/.test(b.which)&&!/input|textarea/i.test(b.target.tagName)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var e=c(d),g=e.hasClass("open");if(!g&&27!=b.which||g&&27==b.which)return 27==b.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.divider):visible a",i=e.find('[role="menu"]'+h+', [role="listbox"]'+h);if(i.length){var j=i.index(b.target);38==b.which&&j>0&&j--,40==b.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',g.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',g.prototype.keydown)}(jQuery),MG.button_layout=function(a){"use strict";return this.target=a,this.feature_set={},this.public_name={},this.sorters={},this.manual=[],this.manual_map={},this.manual_callback={},this._strip_punctuation=function(a){var b=a.replace(/[^a-zA-Z0-9 _]+/g,""),c=b.replace(/ +?/g,"");return c},this.data=function(a){return this._data=a,this},this.manual_button=function(a,b,c){return this.feature_set[a]=b,this.manual_map[this._strip_punctuation(a)]=a,this.manual_callback[a]=c,this},this.button=function(a){return arguments.length>1&&(this.public_name[a]=arguments[1]),arguments.length>2&&(this.sorters[a]=arguments[2]),this.feature_set[a]=[],this},this.callback=function(a){return this._callback=a,this},this.display=function(){var a,b,c,d,e=this._callback,f=this.manual_callback,g=this.manual_map;c=Object.keys(this.feature_set);var h,i=function(b){return a[b]};for(h=0;h<this._data.length;h++){a=this._data[h],b=c.map(i);for(var j=0;j<c.length;j++)d=c[j],-1===this.feature_set[d].indexOf(b[j])&&this.feature_set[d].push(b[j])}for(d in this.feature_set)this.sorters.hasOwnProperty(d)&&this.feature_set[d].sort(this.sorters[d]);$(this.target).empty(),$(this.target).append("<div class='col-lg-12 segments text-center'></div>");var k=function(){var a,b=$(this).data("key"),c=$(this).data("feature");return $("."+c+"-btns button.btn span.title").html(b),g.hasOwnProperty(c)?(a=g[c],f[a](b)):e(c,b),!1};for(var l in this.feature_set){for(c=this.feature_set[l],$(this.target+" div.segments").append('<div class="btn-group '+this._strip_punctuation(l)+'-btns text-left"><button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown"><span class=\'which-button\'>'+(this.public_name.hasOwnProperty(l)?this.public_name[l]:l)+"</span><span class='title'>"+(this.manual_callback.hasOwnProperty(l)?this.feature_set[l][0]:"all")+'</span><span class="caret"></span></button><ul class="dropdown-menu" role="menu">'+(this.manual_callback.hasOwnProperty(l)?"":'<li><a href="#" data-feature="'+l+'" data-key="all">All</a></li>')+(this.manual_callback.hasOwnProperty(l)?"":'<li class="divider"></li>')+"</ul></div>"),h=0;h<c.length;h++)"all"!==c[h]&&void 0!==c[h]&&$(this.target+" div."+this._strip_punctuation(l)+"-btns ul.dropdown-menu").append('<li><a href="#" data-feature="'+this._strip_punctuation(l)+'" data-key="'+c[h]+'">'+c[h]+"</a></li>");$("."+this._strip_punctuation(l)+"-btns .dropdown-menu li a").on("click",k)}return this},this},charts.line=function(a){"use strict";return this.args=a,this.init=function(a){return raw_data_transformation(a),process_line(a),init(a),x_axis(a),y_axis(a),this},this.mainPlot=function(){var b,c=mg_get_svg_child_of(a.target),d=0,e=a.transition_on_update?1e3:0,f=function(b){return b[a.y_accessor]},g=d3.svg.area().x(a.scalefns.xf).y0(a.scales.Y.range()[0]).y1(a.scalefns.yf).interpolate(a.interpolate),h=c.select(".mg-confidence-band");a.show_confidence_band&&(b=d3.svg.area().x(a.scalefns.xf).y0(function(b){var c=a.show_confidence_band[0];return a.scales.Y(b[c])}).y1(function(b){var c=a.show_confidence_band[1];return a.scales.Y(b[c])}).interpolate(a.interpolate));for(var i,j,k=d3.svg.line().x(a.scalefns.xf).y(a.scalefns.yf).interpolate(a.interpolate),l=d3.svg.line().x(a.scalefns.xf).y(function(){return a.scales.Y(d)}).interpolate(a.interpolate),m="",n=a.data.length-1;n>=0;n--){i=a.data[n];var o=n+1;a.custom_line_color_map.length>0&&(o=a.custom_line_color_map[n]),a.data[n].line_id=o,a.show_confidence_band&&(j=h.empty()?c.append("path").attr("class","mg-confidence-band"):h.transition().duration(function(){return a.transition_on_update?1e3:0}),j.attr("d",b(a.data[n])).attr("clip-path","url(#mg-plot-window-"+mg_strip_punctuation(a.target)+")"));var p=c.selectAll(".mg-area"+o+"-color"),q=a.area&&!a.use_data_y_min&&!a.y_axis_negative&&a.data.length<=1;q?p.empty()?c.append("path").attr("class","mg-main-area mg-area"+o+"-color").attr("d",g(a.data[n])).attr("clip-path","url(#mg-plot-window-"+mg_strip_punctuation(a.target)+")"):(c.select(".mg-y-axis").node().parentNode.appendChild(p.node()),p.transition().duration(e).attr("d",g(a.data[n])).attr("clip-path","url(#mg-plot-window-"+mg_strip_punctuation(a.target)+")")):p.empty()||p.remove();var r=c.select("path.mg-main-line.mg-line"+o+"-color");if(r.empty())a.animate_on_load?(d=d3.median(a.data[n],f),c.append("path").attr("class","mg-main-line mg-line"+o+"-color").attr("d",l(a.data[n])).transition().duration(1e3).attr("d",k(a.data[n])).attr("clip-path","url(#mg-plot-window-"+mg_strip_punctuation(a.target)+")")):c.append("path").attr("class","mg-main-line mg-line"+o+"-color").attr("d",k(a.data[n])).attr("clip-path","url(#mg-plot-window-"+mg_strip_punctuation(a.target)+")");else{c.select(".mg-y-axis").node().parentNode.appendChild(r.node());var s=r.transition().duration(e);q?s.attr("d",k(a.data[n])):s.attrTween("d",pathTween(k(a.data[n]),4))}var t=c.select(".mg-line"+o+"-color");if(a.missing_is_hidden&&null!==t.attr("d")){var u,v,w,x,y,z,A,B=t.attr("d").split("L"),C=a.scales.Y(0)+42.1234,D=[],E=2,F=0;B[0]=B[0].replace("M",""),B[B.length-1]=B[B.length-1].replace("Z",""),a.min_x&&D.push(0);for(var G=0;G<B.length-1;G++)u=B[G].split(","),v=B[G+1].split(","),w=Number(u[0]),x=Number(u[1]),y=Number(v[0]),z=Number(v[1]),A=Math.sqrt(Math.pow(w-y,2)+Math.pow(x-z,2)),z==C&&x!=C?(D.push(F||E),F=F?A:A-E):z!=C&&x==C?(D.push(F+=A),F=0):F+=A;D.length>0&&(D.push(t.node().getTotalLength()-D[D.length-1]),c.select(".mg-line"+o+"-color").attr("stroke-dasharray",D.join()))}a.legend&&(m="<span class='mg-line"+o+"-legend-color'>&mdash; "+a.legend[n]+"&nbsp; </span>"+m)}return a.legend&&d3.select(a.legend_target).html(m),this},this.markers=function(){return markers(a),this},this.rollover=function(){var b,c=mg_get_svg_child_of(a.target);c.selectAll(".mg-rollover-rect").remove(),c.selectAll(".mg-voronoi").remove(),c.selectAll(".mg-active-datapoint").remove(),c.selectAll(".mg-line-rollover-circle").remove(),c.selectAll(".mg-active-datapoint-container").remove(),c.append("g").attr("class","mg-active-datapoint-container").attr("transform","translate("+(a.width-a.right)+","+a.top/2+")").append("text").attr("class","mg-active-datapoint").classed("mg-active-datapoint-small",a.use_small_class).attr("xml:space","preserve").attr("text-anchor","end"),c.selectAll(".mg-line-rollover-circle").data(a.data).enter().append("circle").attr({"class":function(a){return["mg-line-rollover-circle","mg-line"+a.line_id+"-color","mg-area"+a.line_id+"-color"].join(" ")},cx:0,cy:0,r:0});for(var d=1,e=0;e<a.data.length;e++){for(var f=0;f<a.data[e].length;f++)a.data[e][f].line_id=a.custom_line_color_map.length>0?a.custom_line_color_map[e]:d;d++}var g,h;if(a.data.length>1&&!a.aggregate_rollover){var i=d3.geom.voronoi().x(function(b){return a.scales.X(b[a.x_accessor]).toFixed(2)}).y(function(b){return a.scales.Y(b[a.y_accessor]).toFixed(2)}).clipExtent([[a.buffer,a.buffer],[a.width-a.buffer,a.height-a.buffer]]);b=c.append("g").attr("class","mg-voronoi"),g=d3.nest().key(function(b){return a.scales.X(b[a.x_accessor])+","+a.scales.Y(b[a.y_accessor])}).rollup(function(a){return a[0]}).entries(d3.merge(a.data.map(function(a){return a}))).map(function(a){return a.values}),b.selectAll("path").data(i(g)).enter().append("path").filter(function(a){return void 0!==a}).attr("d",function(a){return"M"+a.join("L")+"Z"}).datum(function(a){return a.point}).attr("class",function(b){if(a.linked){var c=b[a.x_accessor],d=d3.time.format(a.linked_format),f="number"==typeof c?e:d(c);return"mg-line"+b.line_id+"-color roll_"+f}return"mg-line"+b.line_id+"-color"}).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a))}else a.data.length>1&&a.aggregate_rollover?(g=d3.nest().key(function(b){return b[a.x_accessor]}).entries(d3.merge(a.data)),h=g.map(function(b){return a.scales.X(new Date(b.key))}),b=c.append("g").attr("class","mg-rollover-rect"),b.selectAll(".mg-rollover-rects").data(g).enter().append("rect").attr("x",function(b,c){return 1===h.length?a.left+a.buffer:0===c?h[c].toFixed(2):((h[c-1]+h[c])/2).toFixed(2)}).attr("y",a.top).attr("width",function(b,c){return 1===h.length?a.width-a.right-a.buffer:0===c?((h[c+1]-h[c])/2).toFixed(2):c==h.length-1?((h[c]-h[c-1])/2).toFixed(2):((h[c+1]-h[c-1])/2).toFixed(2)}).attr("height",a.height-a.bottom-a.top-a.buffer).attr("opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a))):(d=1,a.custom_line_color_map.length>0&&(d=a.custom_line_color_map[0]),b=c.append("g").attr("class","mg-rollover-rect"),h=a.data[0].map(a.scalefns.xf),b.selectAll(".mg-rollover-rects").data(a.data[0]).enter().append("rect").attr("class",function(b,c){if(a.linked){var e=b[a.x_accessor],f=d3.time.format(a.linked_format),g="number"==typeof e?c:f(e);return"mg-line"+d+"-color roll_"+g}return"mg-line"+d+"-color"}).attr("x",function(b,c){return 1===h.length?a.left+a.buffer:0===c?h[c].toFixed(2):((h[c-1]+h[c])/2).toFixed(2)}).attr("y",function(b){return a.data.length>1?a.scalefns.yf(b)-6:a.top}).attr("width",function(b,c){return 1===h.length?a.width-a.right-a.buffer:0===c?((h[c+1]-h[c])/2).toFixed(2):c===h.length-1?((h[c]-h[c-1])/2).toFixed(2):((h[c+1]-h[c-1])/2).toFixed(2)}).attr("height",function(){return a.data.length>1?12:a.height-a.bottom-a.top-a.buffer}).attr("opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a)));if(1==a.data.length&&1==a.data[0].length)c.select(".mg-rollover-rect rect").on("mouseover")(a.data[0][0],0);else if(a.data.length>1)for(var e=0;e<a.data.length;e++)1==a.data[e].length&&c.selectAll(".mg-voronoi .mg-line"+(e+1)+"-color").on("mouseover")(a.data[e][0],0);return this},this.rolloverOn=function(a){var b,c=mg_get_svg_child_of(a.target);switch(a.processed.x_time_frame){case"seconds":b=d3.time.format("%b %e, %Y  %H:%M:%S");break;case"less-than-a-day":b=d3.time.format("%b %e, %Y  %I:%M%p");break;case"four-days":b=d3.time.format("%b %e, %Y  %I:%M%p");break;default:b=d3.time.format("%b %e, %Y")}return function(d,e){if(a.aggregate_rollover&&a.data.length>1)c.selectAll("circle.mg-line-rollover-circle").style("opacity",0),d.values.forEach(function(b){if(b[a.x_accessor]>=a.processed.min_x&&b[a.x_accessor]<=a.processed.max_x&&b[a.y_accessor]>=a.processed.min_y&&b[a.y_accessor]<=a.processed.max_y){c.select("circle.mg-line"+b.line_id+"-color").attr({cx:function(){return a.scales.X(b[a.x_accessor]).toFixed(2)},cy:function(){return a.scales.Y(b[a.y_accessor]).toFixed(2)},r:a.point_size}).style("opacity",1)}});else{if(a.missing_is_hidden&&0==d[a.y_accessor]&&d.missing)return;if(d[a.x_accessor]>=a.processed.min_x&&d[a.x_accessor]<=a.processed.max_x&&d[a.y_accessor]>=a.processed.min_y&&d[a.y_accessor]<=a.processed.max_y&&c.selectAll("circle.mg-line-rollover-circle").attr("class","").attr("class","mg-area"+d.line_id+"-color").classed("mg-line-rollover-circle",!0).attr("cx",function(){return a.scales.X(d[a.x_accessor]).toFixed(2)}).attr("cy",function(){return a.scales.Y(d[a.y_accessor]).toFixed(2)}).attr("r",a.point_size).style("opacity",1),a.linked&&!MG.globals.link){MG.globals.link=!0;var f=d[a.x_accessor],g=d3.time.format(a.linked_format),h="number"==typeof f?e:g(f);d3.selectAll(".mg-line"+d.line_id+"-color.roll_"+h).each(function(a,b){d3.select(this).on("mouseover")(a,b)})}}c.selectAll("text").filter(function(a){return d===a}).attr("opacity",.3);var i=rolloverNumberFormatter(a);if(a.show_rollover_text){var j=c.select(".mg-active-datapoint"),k=0,l=1.1;if(j.select("*").remove(),a.aggregate_rollover&&a.data.length>1){if(a.time_series){var m=new Date(d.key);j.append("tspan").text((b(m)+"  "+a.yax_units).trim()),k=1,d.values.forEach(function(b){var c=j.append("tspan").attr({x:0,y:k*l+"em"}).text(i(b[a.y_accessor]));j.append("tspan").attr({x:-c.node().getComputedTextLength(),y:k*l+"em"}).text(" ").classed("mg-hover-line"+b.line_id+"-color",!0).style("font-weight","bold"),k++}),j.append("tspan").attr("x",0).attr("y",k*l+"em").text("")}else d.values.forEach(function(b){var c=j.append("tspan").attr({x:0,y:k*l+"em"}).text(a.x_accessor+": "+b[a.x_accessor]+", "+a.y_accessor+": "+a.yax_units+i(b[a.y_accessor]));j.append("tspan").attr({x:-c.node().getComputedTextLength(),y:k*l+"em"}).text(" ").classed("mg-hover-line"+b.line_id+"-color",!0).style("font-weight","bold"),k++});j.append("tspan").attr("x",0).attr("y",k*l+"em").text("")}else if(a.time_series){var n=new Date(+d[a.x_accessor]);n.setDate(n.getDate()),j.append("tspan").text(b(n)+"  "+a.yax_units+i(d[a.y_accessor]))}else j.append("tspan").text(a.x_accessor+": "+d[a.x_accessor]+", "+a.y_accessor+": "+a.yax_units+i(d[a.y_accessor]))}a.mouseover&&a.mouseover(d,e)}},this.rolloverOff=function(a){var b=mg_get_svg_child_of(a.target);return function(c,d){if(a.linked&&MG.globals.link){MG.globals.link=!1;var e=c[a.x_accessor],f=d3.time.format(a.linked_format),g="number"==typeof e?d:f(e);d3.selectAll(".roll_"+g).each(function(a){d3.select(this).on("mouseout")(a)})}b.selectAll("circle.mg-line-rollover-circle").style("opacity",function(){return 1==a.data.length&&1==a.data[0].length?1:0}),b.select(".mg-active-datapoint").text(""),a.mouseout&&a.mouseout(c,d)}},this.rolloverMove=function(a){return function(b,c){a.mousemove&&a.mousemove(b,c)}},this.windowListeners=function(){return mg_window_listeners(this.args),this},this.init(a),this},charts.histogram=function(a){"use strict";return this.args=a,this.init=function(a){return raw_data_transformation(a),process_histogram(a),init(a),x_axis(a),y_axis(a),this},this.mainPlot=function(){var b=mg_get_svg_child_of(a.target);b.selectAll(".mg-histogram").remove();var c=b.append("g").attr("class","mg-histogram"),d=c.selectAll(".mg-bar").data(a.data[0]).enter().append("g").attr("class","mg-bar").attr("transform",function(b){return"translate("+a.scales.X(b[a.x_accessor]).toFixed(2)+","+a.scales.Y(b[a.y_accessor]).toFixed(2)+")"});return d.append("rect").attr("x",1).attr("width",function(){return 1===a.data[0].length?(a.scalefns.xf(a.data[0][0])-a.bar_margin).toFixed(2):(a.scalefns.xf(a.data[0][1])-a.scalefns.xf(a.data[0][0])-a.bar_margin).toFixed(2)}).attr("height",function(b){return 0===b[a.y_accessor]?0:(a.height-a.bottom-a.buffer-a.scales.Y(b[a.y_accessor])).toFixed(2)}),this},this.markers=function(){return markers(a),this},this.rollover=function(){var b=mg_get_svg_child_of(a.target);b.selectAll(".mg-rollover-rect").remove(),b.selectAll(".mg-active-datapoint").remove(),b.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",a.width-a.right).attr("y",a.top/2).attr("text-anchor","end");var c=b.append("g").attr("class","mg-rollover-rect"),d=c.selectAll(".mg-bar").data(a.data[0]).enter().append("g").attr("class",function(b,c){return a.linked?"mg-rollover-rects roll_"+c:"mg-rollover-rects"}).attr("transform",function(b){return"translate("+a.scales.X(b[a.x_accessor])+",0)"});return d.append("rect").attr("x",1).attr("y",0).attr("width",function(b,c){return 1===a.data[0].length?(a.scalefns.xf(a.data[0][0])-a.bar_margin).toFixed(2):c!==a.data[0].length-1?(a.scalefns.xf(a.data[0][c+1])-a.scalefns.xf(b)).toFixed(2):(a.scalefns.xf(a.data[0][1])-a.scalefns.xf(a.data[0][0])).toFixed(2)}).attr("height",function(){return a.height}).attr("opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a)),this},this.rolloverOn=function(a){{var b=mg_get_svg_child_of(a.target);d3.time.format("%Y-%m-%d")}return function(c,d){b.selectAll("text").filter(function(a){return c===a}).attr("opacity",.3);var e=d3.time.format("%b %e, %Y"),f=rolloverNumberFormatter(a);b.selectAll(".mg-bar rect").filter(function(a,b){return b===d}).classed("active",!0),a.linked&&!MG.globals.link&&(MG.globals.link=!0,d3.selectAll(".mg-rollover-rects.roll_"+d+" rect").each(function(a){d3.select(this).on("mouseover")(a,d)})),a.show_rollover_text&&b.select(".mg-active-datapoint").text(function(){if(a.time_series){var b=new Date(+c[a.x_accessor]);return b.setDate(b.getDate()),e(b)+"  "+a.yax_units+f(c[a.y_accessor])}return a.x_accessor+": "+f(c[a.x_accessor])+", "+a.y_accessor+": "+a.yax_units+f(c[a.y_accessor])}),a.mouseover&&a.mouseover(c,d)}},this.rolloverOff=function(a){var b=mg_get_svg_child_of(a.target);return function(c,d){a.linked&&MG.globals.link&&(MG.globals.link=!1,d3.selectAll(".mg-rollover-rects.roll_"+d+" rect").each(function(a){d3.select(this).on("mouseout")(a,d)})),b.selectAll(".mg-bar rect").classed("active",!1),b.select(".mg-active-datapoint").text(""),a.mouseout&&a.mouseout(c,d)}},this.rolloverMove=function(a){return function(b,c){a.mousemove&&a.mousemove(b,c)}},this.windowListeners=function(){return mg_window_listeners(this.args),this},this.init(a),this},charts.point=function(a){"use strict";return this.args=a,this.init=function(a){return raw_data_transformation(a),process_point(a),init(a),x_axis(a),y_axis(a),this},this.markers=function(){return markers(a),a.least_squares&&add_ls(a),this},this.mainPlot=function(){var b,c=mg_get_svg_child_of(a.target);c.selectAll(".mg-points").remove(),b=c.append("g").classed("mg-points",!0);var d=b.selectAll("circle").data(a.data[0]).enter().append("svg:circle").attr("class",function(a,b){return"path-"+b}).attr("cx",a.scalefns.xf).attr("cy",a.scalefns.yf);return null!==a.color_accessor?(d.attr("fill",a.scalefns.color),d.attr("stroke",a.scalefns.color)):d.classed("mg-points-mono",!0),null!==a.size_accessor?d.attr("r",a.scalefns.size):d.attr("r",a.point_size),this},this.rollover=function(){var b=mg_get_svg_child_of(a.target);b.selectAll(".mg-voronoi").remove(),b.selectAll(".mg-active-datapoint").remove(),b.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",a.width-a.right).attr("y",a.top/2).attr("text-anchor","end");var c=d3.geom.voronoi().x(a.scalefns.xf).y(a.scalefns.yf).clipExtent([[a.buffer,a.buffer],[a.width-a.buffer,a.height-a.buffer]]),d=b.append("g").attr("class","mg-voronoi");return d.selectAll("path").data(c(a.data[0])).enter().append("path").attr("d",function(a){return void 0!==a?"M"+a.join(",")+"Z":void 0}).attr("class",function(a,b){return"path-"+b}).style("fill-opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a)),this},this.rolloverOn=function(a){var b=mg_get_svg_child_of(a.target);return function(c,d){b.selectAll(".mg-points circle").classed("selected",!1);var e=b.selectAll(".mg-points circle.path-"+d).classed("selected",!0);a.size_accessor?e.attr("r",function(b){return a.scalefns.size(b)+1}):e.attr("r",a.point_size),a.linked&&!globals.link&&(globals.link=!0,d3.selectAll(".mg-voronoi .path-"+d).each(function(){d3.select(this).on("mouseover")(c,d)}));var f=d3.time.format("%b %e, %Y"),g=rolloverNumberFormatter(a);a.show_rollover_text&&b.select(".mg-active-datapoint").text(function(){if(a.time_series){var b=new Date(+c.point[a.x_accessor]);return b.setDate(b.getDate()),f(b)+"  "+a.yax_units+g(c.point[a.y_accessor])}return a.x_accessor+": "+g(c.point[a.x_accessor])+", "+a.y_accessor+": "+a.yax_units+g(c.point[a.y_accessor])}),a.mouseover&&a.mouseover(c,d)}},this.rolloverOff=function(a){var b=mg_get_svg_child_of(a.target);return function(c,d){a.linked&&globals.link&&(globals.link=!1,d3.selectAll(".mg-voronoi .path-"+d).each(function(){d3.select(this).on("mouseout")(c,d)}));var e=b.selectAll(".mg-points circle").classed("unselected",!1).classed("selected",!1);a.size_accessor?e.attr("r",a.scalefns.size):e.attr("r",a.point_size),b.select(".mg-active-datapoint").text(""),a.mouseout&&a.mouseout(c,d)}},this.rolloverMove=function(a){return function(b,c){a.mousemove&&a.mousemove(b,c)}},this.update=function(){return this},this.windowListeners=function(){return mg_window_listeners(this.args),this},this.init(a),this},charts.bar=function(a){"use strict";return this.args=a,this.is_vertical=!0,this.init=function(a){return raw_data_transformation(a),process_categorical_variables(a),init(a),this.is_vertical="vertical"===a.bar_orientation,this.is_vertical?(x_axis_categorical(a),y_axis(a)):(x_axis(a),y_axis_categorical(a)),this},this.mainPlot=function(){var b,c,d,e,f,g=mg_get_svg_child_of(a.target),h=a.data[0],i=g.select(".mg-barplot"),j=i.empty(),k=j&&a.animate_on_load,l=k||a.transition_on_update,m=a.transition_duration||1e3;j?(i=g.append("g").classed("mg-barplot",!0),b=i.selectAll(".mg-bar").data(h).enter().append("rect").classed("mg-bar",!0),a.predictor_accessor&&(c=i.selectAll(".mg-bar-prediction").data(h).enter().append("rect").classed("mg-bar-prediction",!0)),a.baseline_accessor&&(f=i.selectAll(".mg-bar-baseline").data(h).enter().append("line").classed("mg-bar-baseline",!0))):(g.select(".mg-y-axis").node().parentNode.appendChild(i.node()),console.log("waylee"),b=i.selectAll("rect.mg-bar"),a.predictor_accessor&&(c=i.selectAll(".mg-bar-prediction")),a.baseline_accessor&&(f=i.selectAll(".mg-bar-baseline")));var n;return this.is_vertical?(n=a.scales.X.rangeBand()/1.5,k&&b.attr("height",0).attr("y",a.scales.Y(0)),l&&(b=b.transition().duration(m)),b.attr("y",function(b){return a.scales.Y(0)-(a.scales.Y(0)-a.scalefns.yf(b))}).attr("x",function(b){return a.scalefns.xf(b)+n/2}).attr("width",n).attr("height",function(b){return 0-(a.scalefns.yf(b)-a.scales.Y(0))}),a.predictor_accessor&&(d=a.predictor_proportion,e=d-1,k&&c.attr("height",0).attr("y",a.scales.Y(0)),l&&(c=c.transition().duration(m)),c.attr("y",function(b){return a.scales.Y(0)-(a.scales.Y(0)-a.scales.Y(b[a.predictor_accessor]))}).attr("x",function(b){return a.scalefns.xf(b)+e*n/(2*d)+n/2}).attr("width",n/d).attr("height",function(b){return 0-(a.scales.Y(b[a.predictor_accessor])-a.scales.Y(0))})),a.baseline_accessor&&(d=a.predictor_proportion,k&&f.attr({y1:a.scales.Y(0),y2:a.scales.Y(0)}),l&&(f=f.transition().duration(m)),f.attr("x1",function(b){return a.scalefns.xf(b)+n/2-n/d+n/2}).attr("x2",function(b){return a.scalefns.xf(b)+n/2+n/d+n/2}).attr("y1",function(b){return a.scales.Y(b[a.baseline_accessor])}).attr("y2",function(b){return a.scales.Y(b[a.baseline_accessor])}))):(n=a.scales.Y.rangeBand()/1.5,k&&b.attr("width",0),l&&(b=b.transition().duration(m)),b.attr("x",a.scales.X(0)).attr("y",function(b){return a.scalefns.yf(b)+n/2}).attr("height",n).attr("width",function(b){return a.scalefns.xf(b)-a.scales.X(0)}),a.predictor_accessor&&(d=a.predictor_proportion,e=d-1,k&&c.attr("width",0),l&&(c=c.transition().duration(m)),c.attr("x",a.scales.X(0)).attr("y",function(b){return a.scalefns.yf(b)+e*n/(2*d)+n/2}).attr("height",n/d).attr("width",function(b){return a.scales.X(b[a.predictor_accessor])-a.scales.X(0)
})),a.baseline_accessor&&(d=a.predictor_proportion,k&&f.attr({x1:a.scales.X(0),x2:a.scales.X(0)}),l&&(f=f.transition().duration(m)),f.attr("x1",function(b){return a.scales.X(b[a.baseline_accessor])}).attr("x2",function(b){return a.scales.X(b[a.baseline_accessor])}).attr("y1",function(b){return a.scalefns.yf(b)+n/2-n/d+n/2}).attr("y2",function(b){return a.scalefns.yf(b)+n/2+n/d+n/2}))),this},this.markers=function(){return markers(a),this},this.rollover=function(){var b,c=mg_get_svg_child_of(a.target);c.selectAll(".mg-rollover-rect").remove(),c.selectAll(".mg-active-datapoint").remove(),c.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",a.width-a.right).attr("y",a.top/2).attr("dy",".35em").attr("text-anchor","end"),b=c.append("g").attr("class","mg-rollover-rect");var d=b.selectAll(".mg-bar-rollover").data(a.data[0]).enter().append("rect").attr("class","mg-bar-rollover");return this.is_vertical?d.attr("x",a.scalefns.xf).attr("y",function(){return a.scales.Y(0)-a.height}).attr("width",a.scales.X.rangeBand()).attr("height",a.height).attr("opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a)):d.attr("x",a.scales.X(0)).attr("y",a.scalefns.yf).attr("width",a.width).attr("height",a.scales.Y.rangeBand()+2).attr("opacity",0).on("mouseover",this.rolloverOn(a)).on("mouseout",this.rolloverOff(a)).on("mousemove",this.rolloverMove(a)),this},this.rolloverOn=function(a){var b=mg_get_svg_child_of(a.target),c=this.is_vertical?a.x_accessor:a.y_accessor,d=this.is_vertical?a.y_accessor:a.x_accessor,e=this.is_vertical?a.yax_units:a.xax_units;return function(f,g){b.selectAll("text").filter(function(a){return f===a}).attr("opacity",.3);var h=d3.time.format("%b %e, %Y"),i=rolloverNumberFormatter(a);b.selectAll("g.mg-barplot .mg-bar").filter(function(a,b){return b===g}).classed("active",!0),a.show_rollover_text&&b.select(".mg-active-datapoint").text(function(){if(a.time_series){var b=new Date(+f[d]);return b.setDate(b.getDate()),h(b)+"  "+e+i(f[c])}return f[c]+": "+i(f[d])}),a.mouseover&&a.mouseover(f,g)}},this.rolloverOff=function(a){var b=mg_get_svg_child_of(a.target);return function(c,d){b.selectAll("g.mg-barplot .mg-bar").classed("active",!1),b.select(".mg-active-datapoint").text(""),a.mouseout&&a.mouseout(c,d)}},this.rolloverMove=function(a){return function(b,c){a.mousemove&&a.mousemove(b,c)}},this.windowListeners=function(){return mg_window_listeners(this.args),this},this.init(a),this},MG.data_table=function(a){"use strict";return this.args=a,this.args.standard_col={width:150,font_size:12,font_weight:"normal"},this.args.columns=[],this.formatting_options=[["color","color"],["font-weight","font_weight"],["font-style","font_style"],["font-size","font_size"]],this._strip_punctuation=function(a){var b=a.replace(/[^a-zA-Z0-9 _]+/g,""),c=b.replace(/ +?/g,"");return c},this._format_element=function(a,b,c){this.formatting_options.forEach(function(d){var e=d[0],f=d[1];c[f]&&a.style(e,"string"==typeof c[f]||"number"==typeof c[f]?c[f]:c[f](b))})},this._add_column=function(a,b){var c=this.args.standard_col,d=merge_with_defaults(MG.clone(a),MG.clone(c));d.type=b,this.args.columns.push(d)},this.target=function(){var a=arguments[0];return this.args.target=a,this},this.title=function(){return this._add_column(arguments[0],"title"),this},this.text=function(){return this._add_column(arguments[0],"text"),this},this.bullet=function(){return this},this.sparkline=function(){return this},this.number=function(){return this._add_column(arguments[0],"number"),this},this.display=function(){var a=this.args;chart_title(a);var b,c,d,e,f,g,h,i,j,k,l,m,n=a.target,o=d3.select(n).append("table").classed("mg-data-table",!0),p=o.append("colgroup"),q=o.append("thead"),r=o.append("tbody");for(d=q.append("tr"),m=0;m<a.columns.length;m++){var s=a.columns[m];g=s.type,i=s.label,i=void 0===i?"":i,e=d.append("th").style("width",s.width).style("text-align","title"===g?"left":"right").text(i),a.show_tooltips&&s.description&&(e.append("i").classed("fa",!0).classed("fa-question-circle",!0).classed("fa-inverse",!0),$(e[0]).popover({html:!0,animation:!1,content:s.description,trigger:"hover",placement:"top",container:$(e[0])}))}for(m=0;m<a.columns.length;m++)l=p.append("col"),"number"===a.columns[m].type&&l.attr("align","char").attr("char",".");for(var t=0;t<a.data.length;t++){d=r.append("tr");for(var u=0;u<a.columns.length;u++){if(b=a.columns[u],f=b.accessor,h=j=a.data[t][f],g=b.type,"number"===g){if(b.hasOwnProperty("round")&&!b.hasOwnProperty("format")&&(j=d3.format("0,."+b.round+"f")(j)),b.hasOwnProperty("value_formatter")&&(j=b.value_formatter(j)),b.hasOwnProperty("format")){b.round&&(j=d3.round(j,b.round));var v,w=b.format;"percentage"===w&&(v=d3.format("%p")),"count"===w&&(v=d3.format("0,000")),"temperature"===w&&(v=function(a){return a+""}),j=v(j)}b.hasOwnProperty("currency")&&(j=b.currency+j)}k=d.append("td").classed("table-"+g,!0).classed("table-"+g+"-"+this._strip_punctuation(f),!0).attr("data-value",h).style("width",b.width).style("text-align","title"===g||"text"===g?"left":"right"),this._format_element(k,h,b),"title"===g?(c=k.append("div").text(j),this._format_element(c,j,b),a.columns[u].hasOwnProperty("secondary_accessor")&&k.append("div").text(a.data[t][a.columns[u].secondary_accessor]).classed("secondary-title",!0)):k.text(j)}}return this},this},charts.missing=function(a){"use strict";return this.args=a,this.init=function(a){chart_title(a),d3.select(a.target).selectAll("svg").data([a]).enter().append("svg").attr("width",a.width).attr("height",a.height);var b=mg_get_svg_child_of(a.target);if(a.width!==Number(b.attr("width"))&&b.attr("width",a.width),a.height!==Number(b.attr("height"))&&b.attr("height",a.height),d3.select(a.target).selectAll("svg *").remove(),b.classed("mg-missing",!0),a.legend_target&&d3.select(a.legend_target).html(""),a.show_missing_background){for(var c=[],d=1;50>=d;d++)c.push({x:d,y:Math.random()-.03*d});a.scales.X=d3.scale.linear().domain([0,c.length]).range([a.left+a.buffer,a.width-a.right-a.buffer]),a.scales.Y=d3.scale.linear().domain([-2,2]).range([a.height-a.bottom-2*a.buffer,a.top]),a.scalefns.xf=function(b){return a.scales.X(b.x)},a.scalefns.yf=function(b){return a.scales.Y(b.y)};var e=d3.svg.line().x(a.scalefns.xf).y(a.scalefns.yf).interpolate(a.interpolate),f=d3.svg.area().x(a.scalefns.xf).y0(a.scales.Y.range()[0]).y1(a.scalefns.yf).interpolate(a.interpolate),g=b.append("g").attr("class","mg-missing-pane");g.append("svg:rect").classed("mg-missing-background",!0).attr("x",a.buffer).attr("y",a.buffer).attr("width",a.width-2*a.buffer).attr("height",a.height-2*a.buffer).attr("rx",15).attr("ry",15),g.append("path").attr("class","mg-main-line mg-line1-color").attr("d",e(c)),g.append("path").attr("class","mg-main-area mg-area1-color").attr("d",f(c))}return b.selectAll(".mg-missing-text").data([a.missing_text]).enter().append("text").attr("class","mg-missing-text").attr("x",a.width/2).attr("y",a.height/2).attr("dy",".50em").attr("text-anchor","middle").text(a.missing_text),this},this.init(a),this},MG.convert={},MG.convert.date=function(a,b,c){return c="undefined"==typeof c?"%Y-%m-%d":c,a=a.map(function(a){var d=d3.time.format(c);return a[b]=d.parse(a[b]),a})},MG.convert.number=function(a,b){return a=a.map(function(a){return a[b]=Number(a[b]),a})};var each=function(a,b,c){if(null===a)return a;if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===breaker)return}else for(var f in a)if(b.call(c,a[f],f,a)===breaker)return;return a};MG.clone=function(a){var b;if(null===a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;d>c;c++)b[c]=MG.clone(a[c]);return b}if(a instanceof Object){b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=MG.clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")};